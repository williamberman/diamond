docker run -it --gpus all --ipc=host -v /mnt/raid:/mnt/raid -v "$(pwd)":/workspace pytorch/pytorch:2.4.1-cuda12.4-cudnn9-runtime bash
apt-get update && apt-get install ffmpeg libsm6 libxext6 git -y && pip install -r requirements.txt

python src/play.py --pretrained --record --recording-dir ./breakout_recordings --default-env test --game 7 --headless-collect-n-episodes 1000
python src/train_action_labeler.py --data_dir ./breakout_recordings/
python src/main.py env.train.id=BreakoutNoFrameskip-v4 common.device=cuda:0

python src/play.py --pretrained --record --recording-dir ./pong_recordings --default-env test --game 20 --headless-collect-n-episodes 400 --device cuda:1
python src/train_action_labeler.py --data_dir ./pong_recordings/ --device cuda:1
python src/main.py env.train.id=PongNoFrameskip-v4 common.device=cuda:1

./run.sh Breakout 0
docker exec -it brave_beaver bash -c "./run.sh Pong 1"
docker exec -it brave_beaver bash -c "./run.sh Alien 2"
docker exec -it brave_beaver bash -c "./run.sh Amidar 3"
docker exec -it brave_beaver bash -c "./run.sh Assault 4"
docker exec -it brave_beaver bash -c "./run.sh Asterix 5"
docker exec -it brave_beaver bash -c "./run.sh BankHeist 6"
docker exec -it brave_beaver bash -c "./run.sh BattleZone 7"

# To watch/play a pretrained agent
python src/play.py --path-ckpt /Users/williamberman/Downloads/agent_epoch_00001.pt --horizon 100 --game Pong
python src/play.py --path-ckpt /Users/williamberman/Downloads/agent_epoch_00004.pt --horizon 100 --game Breakout

# To collect reward data for a pretrained agent
```bash
python src/play.py \
 --path-ckpt /Users/williamberman/Downloads/agent_epoch_00001.pt \
 --game Pong \
 --headless-collect-n-episodes 100 \
 --default-env test \
 --write-rewards ./reward_data/pong_rewards.json
```
```bash
python src/play.py \
 --path-ckpt /Users/williamberman/Downloads/agent_epoch_00004.pt \
 --game Breakout \
 --headless-collect-n-episodes 100 \
 --default-env test \
 --write-rewards ./reward_data/breakout_rewards.json
```

```bash
python src/play.py \
 --path-ckpt /Users/williamberman/Downloads/agent_epoch_00004.pt \
 --game Breakout \
 --headless-collect-n-episodes 4 \
 --headless-collect-n-episodes-threads 2 \
 --default-env test \
 --write-rewards ./reward_data/breakout_rewards.json
```

```bash
python src/compute_atari_100k.py --dir-for-my-scores ./reward_data
```

```bash
python src/play.py \
--pretrained \
--record \
--recording-dir /mnt/raid/diamond/better4/Breakout_recordings_100k \
--game Breakout \
--headless-collect-n-steps 100000 \
--eps 0.1 \
--store-final-obs

python src/train_action_labeler.py \
    --epochs 1000 \
    --checkpoint_dir /mnt/raid/diamond/better4/Breakout_action_labelers_100k_100 \
    --data_dir /mnt/raid/diamond/better4/Breakout_recordings_100k/ \
    --train_size 0.001 \
    --write_new_dataset_dir /mnt/raid/diamond/better4/Breakout_recordings_100k_labeled_100/ \
    --eval_every_n_epochs 200 \
    --lr 1e-4

python src/train_action_labeler.py \
    --epochs 1000 \
    --checkpoint_dir /mnt/raid/diamond/better4/Breakout_action_labelers_100k_100 \
    --data_dir /mnt/raid/diamond/better4/Breakout_recordings_100k/ \
    --train_size 0.01 \
    --write_new_dataset_dir /mnt/raid/diamond/better4/Breakout_recordings_100k_labeled_1000/ \
    --eval_every_n_epochs 200 \
    --lr 1e-4

python src/main.py \
    env.train.id=BreakoutNoFrameskip-v4 \
    hydra.run.dir=/mnt/raid/diamond/better2/Breakout_100k_0.1_labeled \
    wandb.name=Breakout_100k_0.1_labeled \
    collection.path_to_static_dataset=/mnt/raid/diamond/better2/Breakout_recordings_100k_0.1_labeled/ \
    common.device=cuda:0
```
